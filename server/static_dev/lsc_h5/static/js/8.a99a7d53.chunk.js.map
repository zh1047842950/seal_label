{"version":3,"sources":["pages/mall/fixed_goods_detail/index.tsx"],"names":["topTabs","text","value","FixedGoodsDetail","props","nodeHeights","getInitData","newId","a","getGoodsDetail","shopId","match","params","getComments","shopName","storeId","document","title","page","getNodeHeights","getElementsByClassName","offsetTop","onTopTabChange","option","index","scrollTop","onScroll","e","scrollHeight","clientHeight","tab","changeCommonData","opacity","setState","tabValue","state","this","goods","storeInfo","comments","direction","Item","className","style","options","onChange","src","alt","onClick","Dialog","showDownloadModal","shopPriImg","shopPrice","id","type","parseInt","isFavorite","explain","store","theme","hasBottom","nextProps","nextState","nextContext","prevProps","prevState","snapshot","React","Component","connect","mallReducer","commonReducer","dispatch","mallActions","getAuctionScenes","commonActions","bindActionCreators"],"mappings":"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","file":"static/js/8.a99a7d53.chunk.js","sourcesContent":["import React from 'react'\r\nimport {entries} from \"reducer\";\r\nimport {mallActions, commonActions} from \"action\";\r\nimport {bindActionCreators} from \"redux\";\r\nimport {connect} from \"react-redux\";\r\nimport {\r\n    VsonTabs,\r\n    ScrollVertical,\r\n    VsonBanner,\r\n    CollectionGoods,\r\n    StoreTop,\r\n    StoreGoods,\r\n    GoodsDetail,\r\n    BuyGoodsBottom,\r\n    StoreComments,\r\n    CommentsNav,\r\n    BackHome\r\n} from 'components'\r\nimport {Dialog} from 'utils'\r\nimport {Flex} from 'antd-mobile'\r\nimport './index.scss'\r\n\r\n\r\nexport interface P {\r\n    changeCommonData: any,\r\n    getGoodsDetail: any,\r\n    getComments: any,\r\n    storeInfo: any,\r\n    goods: any,\r\n    comments: any[],\r\n    match: any\r\n}\r\n\r\nconst topTabs: any[] = [\r\n    {text: '商品', value: 1},\r\n    {text: '详情', value: 2},\r\n    {text: '评价', value: 3}\r\n]\r\n\r\nexport interface S {\r\n    opacity: number,\r\n    tabValue: number\r\n}\r\n\r\nclass FixedGoodsDetail extends React.Component<P, S> {\r\n    private nodeHeights: any[] = []\r\n\r\n    // 构造\r\n    constructor(props: any) {\r\n        super(props);\r\n        // 初始状态\r\n        this.state = {\r\n            opacity: 0,\r\n            tabValue: 0\r\n        };\r\n    }\r\n\r\n    render(): React.ReactElement<any, string | React.JSXElementConstructor<any>> | string | number | {} | React.ReactNodeArray | React.ReactPortal | boolean | null | undefined {\r\n        const {\r\n            props: {goods, storeInfo, comments},\r\n            state: {opacity, tabValue},\r\n            onScroll,\r\n            onTopTabChange\r\n        } = this\r\n        return (\r\n            <Flex direction={\"column\"}>\r\n                {/*<BackHome className={`home ${!(opacity < 1) ? 'white' : ''}`} />*/}\r\n                <Flex.Item>\r\n                    <ScrollVertical className={'fixed_goods_detail bg1'} onScroll={onScroll}>\r\n                        <Flex className={'top_tab padding_lr bd_d item'} style={{opacity: opacity}}>\r\n                            <Flex.Item>\r\n                                <VsonTabs options={topTabs} value={tabValue} onChange={onTopTabChange} />\r\n                            </Flex.Item>\r\n                            <img src=\"/lsc_h5/imgs/msg_0.png\" alt=\"\" onClick={Dialog.showDownloadModal} />\r\n                        </Flex>\r\n                        <VsonBanner options={goods.shopPriImg} />\r\n                        <div className={'info item padding'}>\r\n                            <Flex>\r\n                                <Flex.Item className={'price1'}>￥{goods.shopPrice}</Flex.Item>\r\n                                <CollectionGoods id={goods.shopId} type={2} state={parseInt(goods.isFavorite)} />\r\n                            </Flex>\r\n                            <div className={'title'}>{goods.shopName}</div>\r\n                            <div className={'explain '}>{goods.explain}</div>\r\n                            <StoreTop className={'bd_u margin_u'} store={storeInfo} />\r\n                        </div>\r\n                        <Flex className={'goods_num item padding margin_u bd_d'}>\r\n                            <Flex.Item>数量</Flex.Item>\r\n                            <div className={'num padding_lr'}>1</div>\r\n                        </Flex>\r\n                        <GoodsDetail goods={goods} className={''} type={2} />\r\n                        <CommentsNav theme={'mall'} />\r\n                        <StoreComments options={comments} />\r\n                        <StoreGoods className={'margin_u'} id={goods.storeId} />\r\n                    </ScrollVertical>\r\n                </Flex.Item>\r\n                <BuyGoodsBottom />\r\n                <BackHome hasBottom={true} />\r\n            </Flex>\r\n        );\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        document.title = '一口价商品详情'\r\n        this.nodeHeights = []\r\n        this.getInitData()\r\n    }\r\n\r\n    getInitData = async (newId?: string) => {\r\n        const {\r\n            getGoodsDetail, match: {params: {shopId}},\r\n            getComments\r\n        } = this.props\r\n        const {shopName, storeId} = await getGoodsDetail(newId || shopId, 2, !!newId)\r\n        document.title = shopName\r\n        await getComments({storeId, page: 1})\r\n    }\r\n\r\n    getNodeHeights = () => {\r\n        this.nodeHeights = [\r\n            0,\r\n            // @ts-ignore\r\n            document.getElementsByClassName('goods_detail_component')[0].offsetTop,\r\n            // @ts-ignore\r\n            document.getElementsByClassName('store_comment_list')[0].offsetTop,\r\n        ]\r\n    }\r\n\r\n    onTopTabChange = (option: any, index: number) => {\r\n        document.getElementsByClassName('tloader')[0].scrollTop = this.nodeHeights[index]\r\n    }\r\n\r\n    onScroll = (e: any) => {\r\n        const {scrollTop, scrollHeight, clientHeight} = e\r\n        const {nodeHeights, props: {changeCommonData}} = this\r\n        let tab = 0;\r\n        let opacity = 1\r\n        switch (true) {\r\n            case scrollTop < 201 || scrollTop < nodeHeights[1]:\r\n                opacity = scrollTop / 200\r\n                break;\r\n            case scrollTop < nodeHeights[2]:\r\n                tab = 1\r\n                break;\r\n            default:\r\n                tab = 2\r\n                break;\r\n        }\r\n        this.setState({tabValue: tab, opacity})\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps: Readonly<any>, nextState: Readonly<any>, nextContext: any): boolean {\r\n        return true\r\n    }\r\n\r\n    componentDidUpdate(prevProps: Readonly<P>, prevState: Readonly<S>, snapshot?: any): void {\r\n        this.getNodeHeights()\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: Readonly<P>, nextContext: any): void {\r\n        const {match: {params: {shopId: newId}}} = nextProps\r\n        const {match: {params: {shopId}}} = this.props\r\n        if (newId !== shopId) {\r\n            this.getInitData(newId)\r\n        }\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state: entries) {\r\n    const {goods} = state.mallReducer\r\n    const {storeInfo, comments} = state.commonReducer\r\n    return {\r\n        goods,\r\n        storeInfo,\r\n        comments\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: any) {\r\n    const {getGoodsDetail, getAuctionScenes} = mallActions\r\n    const {changeCommonData, getComments} = commonActions\r\n    return {\r\n        ...bindActionCreators({\r\n            getGoodsDetail,\r\n            changeCommonData,\r\n            getAuctionScenes,\r\n            getComments\r\n        }, dispatch),\r\n        dispatch\r\n    };\r\n}\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(FixedGoodsDetail)\r\n"],"sourceRoot":""}
