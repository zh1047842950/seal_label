{"version":3,"sources":["pages/museums/collection_edit/index.tsx"],"names":["CollectionEdit","props","init","a","match","params","id","typeId","museumId","getCollectionDetail","changeMuseumData","formFields","changeCommonData","collection","obj","name","objectPriImg","objectDetImg","objectVideo","number","era","size","sizeUnit","weight","weightUnit","place","describe","location","Object","assign","onSave","history","addCollection","updateCollection","fail","stairTwoId","stairOneId","isOk","goBack","state","this","sizeUnits","className","weightUnits","Item","placeholder","limit","type","fieldType","options","title","extra","onClick","document","nextProps","nextState","nextContext","React","Component","connect","museumReducer","commonReducer","dispatch","commonActions","museumActions","bindActionCreators"],"mappings":"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","file":"static/js/17.8456bcbf.chunk.js","sourcesContent":["import React from 'react'\r\nimport './index.scss'\r\nimport {entries} from \"reducer\";\r\nimport {commonActions, museumActions} from \"action\";\r\nimport {bindActionCreators} from \"redux\";\r\nimport {connect} from \"react-redux\";\r\nimport {VsonField, VsonUpload} from 'components'\r\nimport {Flex, Toast} from 'antd-mobile'\r\n\r\ninterface P {\r\n    className?: string,\r\n    history: any,\r\n    match: any,\r\n    collection: any,\r\n    formFields: any,\r\n    getCollectionDetail: any,\r\n    changeCommonData: any,\r\n    addCollection: any,\r\n    updateCollection: any,\r\n    changeMuseumData: any,\r\n    sizeUnits: any[],\r\n    weightUnits: any[]\r\n}\r\n\r\ninterface S {\r\n}\r\n\r\nclass CollectionEdit extends React.Component<P, S> {\r\n    // 构造\r\n    constructor(props: any) {\r\n        super(props);\r\n        // 初始状态\r\n        this.state = {};\r\n    }\r\n\r\n    render(): React.ReactElement<any, string | React.JSXElementConstructor<any>> | string | number | {} | React.ReactNodeArray | React.ReactPortal | boolean | null | undefined {\r\n        const {\r\n            props: {\r\n                className = '',\r\n                sizeUnits,\r\n                weightUnits,\r\n                match: {params: {typeId}}\r\n            },\r\n            state: {},\r\n            onSave\r\n        } = this\r\n        return (\r\n            <div className={`collection_edit_page`}>\r\n                <Flex className={'item'}>\r\n                    <div className={'label'}>藏品标题</div>\r\n                    <Flex.Item>\r\n                        <VsonField name={'name'} placeholder='请输入藏品标题' />\r\n                    </Flex.Item>\r\n                </Flex>\r\n                <div className={'info_header'}>藏品图片</div>\r\n                <div className={'item'}>\r\n                    <div className={'label padding_u'}>藏品主图(1-9张):</div>\r\n                    <VsonUpload limit={9} name={'objectPriImg'} />\r\n                    <div className={'label'}>藏品详情图(1-9张):</div>\r\n                    <VsonUpload limit={9} name={'objectDetImg'} />\r\n                    <div className={'label'}>3D动画或视频(1张,可选):</div>\r\n                    <VsonUpload name={'objectVideo'} type={'video'} />\r\n                </div>\r\n                <div className={'info_header'}>藏品详细参数</div>\r\n                <div className={'item'}>\r\n                    <Flex className={' right'}>\r\n                        <div className={'label '}>编号</div>\r\n                        <Flex.Item>\r\n                            <VsonField name={'number'} placeholder='请输入藏品编号' />\r\n                        </Flex.Item>\r\n                    </Flex>\r\n                    <Flex className={'bd_ud right'}>\r\n                        <div className={'label'}>年代</div>\r\n                        <Flex.Item>\r\n                            <VsonField name={'era'} placeholder='请输入藏品年代' />\r\n                        </Flex.Item>\r\n                    </Flex>\r\n                    <Flex className={' right'}>\r\n                        <div className={'label'}>尺寸</div>\r\n                        <Flex.Item>\r\n                            <VsonField name={'size'} placeholder='请输入藏品尺寸' />\r\n                        </Flex.Item>\r\n                    </Flex>\r\n                    <VsonField className={'bd_ud'} fieldType={'select'} name={'sizeUnit'} options={sizeUnits}\r\n                               props={{title: '尺寸单位', extra: '请选择尺寸单位'}} />\r\n                    <Flex className={' right'}>\r\n                        <div className={'label'}>重量</div>\r\n                        <Flex.Item>\r\n                            <VsonField name={'weight'} placeholder='请输入藏品重量' />\r\n                        </Flex.Item>\r\n                    </Flex>\r\n                    <VsonField className={'bd_ud'} fieldType={'select'} name={'weightUnit'} options={weightUnits}\r\n                               props={{title: '重量单位', extra: '请选择重量单位'}} />\r\n                    <Flex className={'bd_d right'}>\r\n                        <div className={'label'}>产地</div>\r\n                        <Flex.Item>\r\n                            <VsonField name={'place'} placeholder='请输入藏品产地' />\r\n                        </Flex.Item>\r\n                    </Flex>\r\n                    <div className={'label padding_u'}>藏品描述:</div>\r\n                    <VsonField name={'describe'} fieldType={'textarea'} placeholder='请输入藏品描述' />\r\n                    <div className={'label bd_u padding_u'}>藏品位置:</div>\r\n                    <VsonField name={'location'} fieldType={'textarea'} placeholder='请输入藏品位置' />\r\n                </div>\r\n                <div className={'state2'} onClick={onSave}>{typeId === 'edit' ? '保存' : '创建'}</div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        document.title = '藏品编辑'\r\n        this.init()\r\n    }\r\n\r\n    init = async () => {\r\n        const {match: {params: {id, typeId, museumId}}, getCollectionDetail, changeMuseumData, formFields, changeCommonData, collection} = this.props\r\n        const obj: any = {}\r\n        const {\r\n            name, objectPriImg = [], objectDetImg = [], objectVideo = [], number, era, size,\r\n            sizeUnit, weight, weightUnit, place, describe, location\r\n        } = (typeId === 'edit' ? await getCollectionDetail(id) : obj)\r\n        Object.assign(formFields, {\r\n            name,\r\n            objectPriImg,\r\n            objectDetImg,\r\n            objectVideo,\r\n            number,\r\n            era,\r\n            size,\r\n            sizeUnit,\r\n            weight,\r\n            weightUnit,\r\n            place,\r\n            describe,\r\n            location\r\n        })\r\n        await changeCommonData({formFields: {...formFields}})\r\n    }\r\n\r\n    onSave = async () => {\r\n        const {\r\n            history,\r\n            match: {params: {id, typeId, museumId}}, addCollection, updateCollection,\r\n            formFields: {\r\n                name,\r\n                objectPriImg,\r\n                objectDetImg,\r\n                objectVideo,\r\n                number,\r\n                era,\r\n                size,\r\n                sizeUnit,\r\n                weight,\r\n                weightUnit,\r\n                place,\r\n                describe,\r\n                location\r\n            }\r\n        } = this.props\r\n        if (!name || !number) {\r\n            Toast.fail('藏品标题和编号不能为空!')\r\n            return\r\n        }\r\n        const params = {\r\n            name,\r\n            objectPriImg,\r\n            objectDetImg,\r\n            objectVideo,\r\n            number,\r\n            era,\r\n            size,\r\n            sizeUnit,\r\n            weight,\r\n            weightUnit,\r\n            place,\r\n            describe,\r\n            location\r\n        }\r\n        const {isOk} = typeId === 'edit' ? await updateCollection({...params, id}) : await addCollection({\r\n            ...params,\r\n            stairTwoId: id,\r\n            stairOneId: typeId,\r\n            museumId\r\n        })\r\n        if (isOk) {\r\n            history.goBack()\r\n        }\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps: Readonly<any>, nextState: Readonly<any>, nextContext: any): boolean {\r\n        return true\r\n    }\r\n}\r\n\r\n\r\nfunction mapStateToProps(state: entries) {\r\n    const {collection} = state.museumReducer\r\n    const {formFields, sizeUnits, weightUnits} = state.commonReducer\r\n    return {collection, formFields, sizeUnits, weightUnits}\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: any) {\r\n    const {changeCommonData} = commonActions\r\n    const {getCollectionDetail, addCollection, updateCollection, changeMuseumData} = museumActions\r\n    return {\r\n        ...bindActionCreators({\r\n            getCollectionDetail,\r\n            changeCommonData,\r\n            addCollection,\r\n            changeMuseumData,\r\n            updateCollection\r\n        }, dispatch),\r\n        dispatch\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CollectionEdit)\r\n"],"sourceRoot":""}