{"version":3,"sources":["pages/mall/product_goods_detail/index.tsx"],"names":["topTabs","text","value","ProductGoodsDetail","props","nodeHeights","onTopTabChange","option","index","document","getElementsByClassName","scrollTop","getInitData","newId","a","getGoodsDetail","shopId","match","params","getComments","shopName","storeId","page","getNodeHeights","offsetTop","onScroll","e","scrollHeight","clientHeight","tab","changeCommonData","opacity","setState","tabValue","state","this","goods","storeInfo","comments","direction","className","Item","style","options","onChange","src","alt","onClick","Dialog","showDownloadModal","shopPriImg","shopPrice","id","type","parseInt","isFavorite","explain","store","name","fieldType","min","defaultValue","hasBottom","title","nextProps","nextState","nextContext","prevProps","prevState","snapshot","React","Component","connect","mallReducer","commonReducer","dispatch","mallActions","getAuctionScenes","commonActions","bindActionCreators"],"mappings":"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","file":"static/js/10.328e683f.chunk.js","sourcesContent":["import React from 'react'\r\nimport {entries} from \"reducer\";\r\nimport {mallActions, commonActions} from \"action\";\r\nimport {bindActionCreators} from \"redux\";\r\nimport {connect} from \"react-redux\";\r\nimport {\r\n    VsonTabs,\r\n    ScrollVertical,\r\n    VsonBanner,\r\n    CollectionGoods,\r\n    StoreTop,\r\n    StoreGoods,\r\n    GoodsDetail,\r\n    BuyGoodsBottom,\r\n    VsonField,\r\n    BackHome\r\n} from 'components'\r\nimport {Dialog} from 'utils'\r\nimport {Flex} from 'antd-mobile'\r\nimport './index.scss'\r\n\r\nexport interface P {\r\n    changeCommonData: any,\r\n    getGoodsDetail: any,\r\n    getComments: any,\r\n    storeInfo: any,\r\n    goods: any,\r\n    comments: any[],\r\n    match: any\r\n}\r\n\r\nconst topTabs: any[] = [\r\n    {text: '商品', value: 1},\r\n    {text: '详情', value: 2},\r\n    // {text: '评价', value: 3}\r\n]\r\n\r\nexport interface S {\r\n    opacity: number,\r\n    tabValue: number\r\n}\r\n\r\nclass ProductGoodsDetail extends React.Component<P, S> {\r\n    private nodeHeights: any[] = []\r\n\r\n    // 构造\r\n    constructor(props: any) {\r\n        super(props);\r\n        // 初始状态\r\n        this.state = {\r\n            opacity: 0,\r\n            tabValue: 0\r\n        };\r\n    }\r\n\r\n    render(): React.ReactElement<any, string | React.JSXElementConstructor<any>> | string | number | {} | React.ReactNodeArray | React.ReactPortal | boolean | null | undefined {\r\n        const {\r\n            props: {goods, storeInfo, comments},\r\n            state: {opacity, tabValue},\r\n            onScroll,\r\n            onTopTabChange\r\n        } = this\r\n        return (\r\n            <Flex direction={\"column\"} className={'product_goods_detail bg1'}>\r\n                {/*<BackHome className={`home ${!(opacity < 1) ? 'white' : ''}`} />*/}\r\n                <Flex.Item>\r\n                    <ScrollVertical onScroll={onScroll}>\r\n                        <Flex className={'top_tab padding_lr bd_d item'} style={{opacity: opacity}}>\r\n                            <Flex.Item>\r\n                                <VsonTabs options={topTabs} value={tabValue} onChange={onTopTabChange} />\r\n                            </Flex.Item>\r\n                            <img src=\"/lsc_h5/imgs/msg_0.png\" alt=\"\" onClick={Dialog.showDownloadModal} />\r\n                        </Flex>\r\n                        <VsonBanner options={goods.shopPriImg} />\r\n                        <div className={'info item padding'}>\r\n                            <Flex>\r\n                                <Flex.Item className={'price1'}>￥{goods.shopPrice}</Flex.Item>\r\n                                <CollectionGoods id={goods.shopId} type={3} state={parseInt(goods.isFavorite)} />\r\n                            </Flex>\r\n                            <div className={'title'}>{goods.shopName}</div>\r\n                            <div className={'explain '}>{goods.explain}</div>\r\n                            <StoreTop className={'bd_u margin_u'} store={storeInfo} />\r\n                        </div>\r\n                        <Flex className={'goods_num item padding margin_u bd_d'}>\r\n                            <Flex.Item>数量</Flex.Item>\r\n                            <VsonField name={'num'} className={'num padding_lr'} fieldType={'stepper'}\r\n                                       props={{min: 1}} defaultValue={1} />\r\n                        </Flex>\r\n                        <GoodsDetail goods={goods} className={''} type={3} />\r\n                        <StoreGoods className={'margin_u'} id={goods.storeId} />\r\n                    </ScrollVertical>\r\n                </Flex.Item>\r\n                <BuyGoodsBottom />\r\n                <BackHome hasBottom={true} />\r\n            </Flex>\r\n        );\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        document.title = '一口价商品详情'\r\n        this.nodeHeights = []\r\n        this.getInitData()\r\n    }\r\n\r\n    onTopTabChange = (option: any, index: number) => {\r\n        document.getElementsByClassName('tloader')[0].scrollTop = this.nodeHeights[index]\r\n    }\r\n\r\n    getInitData = async (newId?: string) => {\r\n        const {\r\n            getGoodsDetail, match: {params: {shopId}},\r\n            getComments\r\n        } = this.props\r\n        const {shopName, storeId} = await getGoodsDetail(newId || shopId, 3, !!newId)\r\n        await getComments({storeId, page: 1})\r\n    }\r\n\r\n    getNodeHeights = () => {\r\n        this.nodeHeights = [\r\n            0,\r\n            // @ts-ignore\r\n            document.getElementsByClassName('goods_detail_component')[0].offsetTop,\r\n        ]\r\n    }\r\n\r\n    onScroll = (e: any) => {\r\n        const {scrollTop, scrollHeight, clientHeight} = e\r\n        // this.getNodeHeights()\r\n        const {nodeHeights, props: {changeCommonData}} = this\r\n        let tab = 0;\r\n        let opacity = 1\r\n        switch (true) {\r\n            case scrollTop < 201 || scrollTop < nodeHeights[1]:\r\n                opacity = scrollTop / 200\r\n                break;\r\n            default:\r\n                tab = 1\r\n                break;\r\n        }\r\n        this.setState({tabValue: tab, opacity})\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps: Readonly<any>, nextState: Readonly<any>, nextContext: any): boolean {\r\n        return true\r\n    }\r\n\r\n    componentDidUpdate(prevProps: Readonly<P>, prevState: Readonly<S>, snapshot?: any): void {\r\n        this.getNodeHeights()\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: Readonly<P>, nextContext: any): void {\r\n        const {match: {params: {shopId: newId}}} = nextProps\r\n        const {match: {params: {shopId}}} = this.props\r\n        if (newId !== shopId) {\r\n            this.getInitData(newId)\r\n        }\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state: entries) {\r\n    const {goods} = state.mallReducer\r\n    const {storeInfo, comments} = state.commonReducer\r\n    return {\r\n        goods,\r\n        storeInfo,\r\n        comments\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: any) {\r\n    const {getGoodsDetail, getAuctionScenes} = mallActions\r\n    const {changeCommonData, getComments} = commonActions\r\n    return {\r\n        ...bindActionCreators({\r\n            getGoodsDetail,\r\n            changeCommonData,\r\n            getAuctionScenes,\r\n            getComments\r\n        }, dispatch),\r\n        dispatch\r\n    };\r\n}\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(ProductGoodsDetail)\r\n\r\n\r\n"],"sourceRoot":""}
