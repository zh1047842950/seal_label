{"version":3,"sources":["pages/museums/collection_detail/index.tsx"],"names":["CollectionDetail","props","onComment","a","commentCollection","formFields","getCollectionComments","changeCommonData","toggleModal","id","collection","content","isOk","page","onSetBoutique","setBoutique","getCollectionDetail","isBoutique","status","parseInt","onPraise","praiseCollection","onAttention","attentionMuseum","museumId","isAttention","onFavorite","favoriteCollection","isFavorite","getInit","match","params","myMuseums","name","document","title","index","findIndex","e","setState","isMySelf","state","this","className","collectionComments","direction","Item","fixHeight","options","objectPriImg","to","museumLogo","src","medium","alt","museumName","onClick","isPraise","praiseNum","describe","theme","list","popup","animationType","fieldType","justify","hasBottom","nextProps","nextState","nextContext","React","Component","connect","museumReducer","commonReducer","dispatch","commonActions","museumActions","bindActionCreators"],"mappings":"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","file":"static/js/16.ae45ce3f.chunk.js","sourcesContent":["import React from 'react'\r\nimport {bindActionCreators} from 'redux'\r\nimport {connect} from 'react-redux'\r\nimport {entries} from 'reducer'\r\nimport {commonActions, museumActions} from 'action'\r\nimport {Flex} from 'antd-mobile'\r\nimport {Link} from 'react-router-dom'\r\nimport {\r\n    BackHome,\r\n    VsonField,\r\n    VsonBanner,\r\n    VsonModal,\r\n    CollectionDetail as CollectionDetailBody,\r\n    ScrollVertical,\r\n    CollectionComments,\r\n    CommentsNav\r\n} from 'components'\r\nimport './index.scss'\r\n\r\ninterface P {\r\n    className?: string,\r\n    history: any,\r\n    match: any,\r\n    collection: any,\r\n    collectionComments: any,\r\n    myMuseums: any[],\r\n    getCollectionDetail: any,\r\n    getCollectionComments: any,\r\n    praiseCollection: any,\r\n    attentionMuseum: any,\r\n    favoriteCollection: any,\r\n    setBoutique: any,\r\n    toggleModal: any,\r\n    commentCollection: any,\r\n    formFields: any,\r\n    changeCommonData: any\r\n}\r\n\r\ninterface S {\r\n    isMySelf: boolean\r\n}\r\n\r\nclass CollectionDetail extends React.Component<P, S> {\r\n    // 构造\r\n    constructor(props: any) {\r\n        super(props);\r\n        // 初始状态\r\n        this.state = {\r\n            isMySelf: false\r\n        };\r\n    }\r\n\r\n    render(): React.ReactElement<any, string | React.JSXElementConstructor<any>> | string | number | {} | React.ReactNodeArray | React.ReactPortal | boolean | null | undefined {\r\n        const {\r\n            props: {\r\n                className = '',\r\n                collection,\r\n                collectionComments,\r\n                toggleModal\r\n            },\r\n            state: {isMySelf},\r\n            onAttention,\r\n            onFavorite,\r\n            onPraise,\r\n            onSetBoutique,\r\n            onComment\r\n        } = this\r\n        return (\r\n            <Flex className={`collection_detail_page`} direction={\"column\"}>\r\n                <Flex.Item>\r\n                    <ScrollVertical>\r\n                        <VsonBanner fixHeight={true} options={collection.objectPriImg} />\r\n                        <div className={'item base_infos'}>\r\n                            <div className={'name'}>{collection.name}</div>\r\n                            <div className={'museum_name'}>\r\n                                <Link to={'/museums/museum_home/' + collection.museumId}>\r\n                                    {!!collection.museumLogo && <img src={collection.museumLogo.medium} alt=\"\" />}\r\n                                    {collection.museumName}\r\n                                </Link>\r\n                            </div>\r\n                            <Flex className={'actions'}>\r\n                                <div onClick={onPraise} className={collection.isPraise === '0' ? 'active' : ''}>\r\n                                    <img src={'/lsc_h5/imgs/like_' + (collection.isPraise === '0' ? 2 : 3) + '.png'} alt=\"\" />\r\n                                    <span>{collection.praiseNum}</span>\r\n                                </div>\r\n                                <div onClick={onAttention}>{collection.isAttention === '0' ? '已' : ''}关注</div>\r\n                                <div onClick={onFavorite}>{collection.isFavorite === '0' ? '已' : ''}收藏</div>\r\n                                <div>客服</div>\r\n                            </Flex>\r\n                            <div className={'describe'}>{collection.describe}</div>\r\n                        </div>\r\n                        <CollectionDetailBody collection={collection} />\r\n                        <div className={'item comments'}>\r\n                            <CommentsNav theme={'museum'} params={[collection.id]} />\r\n                            <CollectionComments list={collectionComments} />\r\n                        </div>\r\n                    </ScrollVertical>\r\n                </Flex.Item>\r\n                <Flex className={'oprs state7'}>\r\n                    {\r\n                        isMySelf && <Link className={'opr'} to={'/museums/collection_edit/' + collection.id + '/edit'}>\r\n                          <img src=\"/lsc_h5/imgs/edit3.png\" alt=\"\" />\r\n                          <span>编辑</span>\r\n                        </Link>\r\n                    }\r\n                    {\r\n                        isMySelf && <div className={'opr'} onClick={onSetBoutique}>\r\n                          <img src=\"/lsc_h5/imgs/boutique.png\" alt=\"\" />\r\n                          <span>{collection.isBoutique === '1' ? '设为' : '取消'}精品</span>\r\n                        </div>\r\n                    }\r\n                    <div className={'opr'} onClick={toggleModal}>\r\n                        <img src=\"/lsc_h5/imgs/comment1.png\" alt=\"\" />\r\n                        <span>点评</span>\r\n                    </div>\r\n                </Flex>\r\n                <VsonModal className={'collection_comment'}\r\n                           props={{popup: true, animationType: 'slide-up', title: '藏品评论'}}>\r\n                    <VsonField name={'content'} fieldType={'textarea'} />\r\n                    <Flex justify={\"end\"}>\r\n                        <span onClick={onComment} className={'state2'}>评论</span>\r\n                    </Flex>\r\n                </VsonModal>\r\n                <BackHome hasBottom={true} />\r\n            </Flex>\r\n        );\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        this.getInit()\r\n    }\r\n\r\n    onComment = async () => {\r\n        const {commentCollection, formFields, getCollectionComments, changeCommonData, toggleModal, collection: {id}} = this.props\r\n        const {isOk} = await commentCollection({id, content: formFields.content})\r\n        if (isOk) {\r\n            await toggleModal()\r\n            formFields.content = ''\r\n            await changeCommonData({formFields: {...formFields}})\r\n            await getCollectionComments({id, page: 1})\r\n        }\r\n    }\r\n\r\n    onSetBoutique = async () => {\r\n        const {setBoutique, getCollectionDetail, collection: {id, isBoutique}} = this.props\r\n        const {isOk} = await setBoutique({\r\n            id,\r\n            status: parseInt(isBoutique)\r\n        })\r\n        if (isOk) {\r\n            await getCollectionDetail(id)\r\n        }\r\n    }\r\n\r\n    onPraise = async () => {\r\n        const {praiseCollection, getCollectionDetail, collection: {id}} = this.props\r\n        const {isOk} = await praiseCollection(id)\r\n        if (isOk) {\r\n            await getCollectionDetail(id)\r\n        }\r\n    }\r\n\r\n    onAttention = async () => {\r\n        const {attentionMuseum, getCollectionDetail, collection: {museumId, isAttention, id}} = this.props\r\n        const {isOk} = await attentionMuseum({\r\n            id: museumId,\r\n            isAttention: isAttention === '0' ? 1 : 0\r\n        })\r\n        if (isOk) {\r\n            await getCollectionDetail(id)\r\n        }\r\n    }\r\n    onFavorite = async () => {\r\n        const {favoriteCollection, getCollectionDetail, collection: {id, isFavorite}} = this.props\r\n        const {isOk} = await favoriteCollection({\r\n            id,\r\n            status: parseInt(isFavorite)\r\n        })\r\n        if (isOk) {\r\n            await getCollectionDetail(id)\r\n        }\r\n    }\r\n\r\n    getInit = async () => {\r\n        const {match: {params: {id}}, formFields, changeCommonData, getCollectionDetail, getCollectionComments, myMuseums} = this.props\r\n        const {name, museumId} = await getCollectionDetail(id)\r\n        document.title = name\r\n        await getCollectionComments({id, page: 1})\r\n        formFields.content = ''\r\n        await changeCommonData({formFields: {...formFields}})\r\n        const index = myMuseums.findIndex((e: any) => e.museumId === museumId)\r\n        this.setState({isMySelf: index !== -1})\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps: Readonly<any>, nextState: Readonly<any>, nextContext: any): boolean {\r\n        return true\r\n    }\r\n}\r\n\r\n\r\nfunction mapStateToProps(state: entries) {\r\n    const {collection, collectionComments} = state.museumReducer\r\n    const {myMuseums, formFields} = state.commonReducer\r\n    return {collection, myMuseums, formFields, collectionComments}\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: any) {\r\n    const {toggleModal, changeCommonData} = commonActions\r\n    const {getCollectionDetail, getCollectionComments, commentCollection, praiseCollection, attentionMuseum, favoriteCollection, setBoutique} = museumActions\r\n    return {\r\n        ...bindActionCreators({\r\n            getCollectionDetail,\r\n            getCollectionComments,\r\n            praiseCollection,\r\n            attentionMuseum,\r\n            favoriteCollection,\r\n            setBoutique,\r\n            toggleModal,\r\n            commentCollection,\r\n            changeCommonData\r\n        }, dispatch),\r\n        dispatch\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CollectionDetail)\r\n"],"sourceRoot":""}
