{"version":3,"sources":["pages/mall/store_home/index.tsx"],"names":["StoreHome","props","onTabChange","a","changeMallData","changeCommonData","page","totalPage","goodsList","getList","getStoreHome","formFields","storeId","match","params","sort","shopType","getInitData","wxOAuth2","storeInfo","storeName","storePresen","storeImg","WxConfig","onShare","title","desc","imgUrl","medium","handleScroll","e","scrollTop","state","fixedFilter","setState","this","sortRules","goodsTypes","className","onScroll","onLoadData","store","initValue","options","name","onChange","list","nextProps","nextState","nextContext","React","Component","connect","mallReducer","commonReducer","slice","dispatch","mallActions","commonActions","bindActionCreators"],"mappings":"gVA6BMA,E,keAEF,WAAYC,GAAa,IAAD,8BACpB,cAAMA,IAsCVC,YAvCwB,sBAuCV,gCAAAC,EAAA,+DACiC,EAAKF,MAAzCG,EADG,EACHA,eAAgBC,EADb,EACaA,iBADb,SAEJA,EAAiB,CAACC,KAAM,EAAGC,UAAW,IAFlC,uBAGJH,EAAe,CAACI,UAAW,KAHvB,OAIV,EAAKC,UAJK,2CAvCU,EA8CxBA,QA9CwB,sBA8Cd,4CAAAN,EAAA,+DAC+D,EAAKF,MAAnES,EADD,EACCA,aAAcC,EADf,EACeA,WAAYL,EAD3B,EAC2BA,KAAuBM,EADlD,EACiCC,MAAQC,OAASF,QADlD,EAE2BD,EAA1BI,YAFD,MAEQ,EAFR,IAE2BJ,EAAhBK,gBAFX,MAEsB,EAFtB,WAGON,EAAa,CAACE,UAASG,OAAMC,WAAUV,SAH9C,mFA9Cc,EAoDxBW,YApDwB,sBAoDV,0CAAAd,EAAA,8EACKe,EADL,EACHjB,MAAQiB,SAAWT,EADhB,EACgBA,QADhB,SAEJS,IAFI,uBAGoDT,IAHpD,2BAGHU,UAAYC,EAHT,EAGSA,UAAWC,EAHpB,EAGoBA,YAAaC,EAHjC,EAGiCA,SAHjC,UAIJC,IAASC,QAAQ,CACnBC,MAAOL,EACPM,KAAML,GAAeD,EACrBO,OAAQL,EAASM,SAPX,4CApDU,EA+DxBC,aAAe,SAACC,GAAY,IACjBC,EAAaD,EAAbC,UACe,EAAKC,MAApBC,aACYF,EAAY,KAC/B,EAAKG,SAAS,CAACD,YAAaF,EAAY,OAhExC,EAAKC,MAAQ,CACTC,aAAa,GAJG,E,qDAQqJ,IAAD,EAOpKE,KALAlC,MAAQmC,EAF4J,EAE5JA,UAAWC,EAFiJ,EAEjJA,WAAYlB,EAFqI,EAErIA,UAAWX,EAF0H,EAE1HA,UAClCyB,EAIRE,KAJAH,MAAQC,YACR/B,EAGAiC,KAHAjC,YACAO,EAEA0B,KAFA1B,QACAoB,EACAM,KADAN,aAEJ,OACI,kBAAC,IAAD,CAAgBS,UAAW,kBAAmBC,SAAUV,EAAcW,WAAY/B,GAE9E,yBAAK6B,UAAW,eACZ,kBAAC,IAAD,CAAUA,UAAW,SAAUG,MAAOtB,IACtC,yBAAKmB,UAAW,kBACZ,yBAAKA,UAAS,kBAAaL,EAAc,QAAU,KAC/C,kBAAC,IAAD,CAAUS,UAAW,EAAGC,QAASN,EAAYO,KAAM,WACzCC,SAAU3C,IACpB,kBAAC,IAAD,CAAUwC,UAAW,EAAGC,QAASP,EAAWQ,KAAM,OAAQC,SAAU3C,OAIhF,kBAAC,IAAD,CAAW4C,KAAMtC,IACjB,kBAAC,IAAD,S,0CAMR2B,KAAKlB,gB,4CAkCa8B,EAA0BC,EAA0BC,GACtE,OAAO,M,GAzESC,IAAMC,WAwGfC,uBA3Bf,SAAyBpB,GAAiB,IAC/BxB,EAAawB,EAAMqB,YAAnB7C,UAD8B,EAEwBwB,EAAMsB,cAA5DnC,EAF8B,EAE9BA,UAAWkB,EAFmB,EAEnBA,WAAYD,EAFO,EAEPA,UAAWzB,EAFJ,EAEIA,WAAYL,EAFhB,EAEgBA,KACrD,MAAO,CACHE,YACAW,YACAkB,WAAY,YAAIA,GAAYkB,MAAM,EAAG,GACrCnB,YACAzB,aACAL,WAIR,SAA4BkD,GAAgB,IACjC9C,EAAgC+C,IAAhC/C,aAAcN,EAAkBqD,IAAlBrD,eACdc,EAA8BwC,IAA9BxC,SAAUb,EAAoBqD,IAApBrD,iBACjB,OAAO,2BACAsD,6BAAmB,CAClBjD,eACAN,iBACAC,mBACAa,YACDsC,IANP,IAOIA,eAIOJ,CAGbpD","file":"static/js/12.5b9df50a.chunk.js","sourcesContent":["import React from 'react'\r\nimport {bindActionCreators} from \"redux\";\r\nimport {connect} from \"react-redux\";\r\nimport {entries} from \"reducer\";\r\nimport {mallActions, commonActions} from \"action\";\r\nimport {WxConfig} from \"utils\";\r\nimport {StoreTop, VsonTabs, GoodsList, ScrollVertical, BackHome} from 'components'\r\n\r\nimport './index.scss';\r\n\r\ninterface P {\r\n    changeCommonData: any,\r\n    doAttentionStore: any,\r\n    wxOAuth2: any,\r\n    changeMallData: any,\r\n    getStoreHome: any,\r\n    goodsList: any[],\r\n    goodsTypes: any[],\r\n    sortRules: any[],\r\n    storeInfo: any,\r\n    match: any,\r\n    formFields: any,\r\n    page: number\r\n}\r\n\r\ninterface S {\r\n    fixedFilter: boolean\r\n}\r\n\r\nclass StoreHome extends React.Component<P, S> {\r\n    // 构造\r\n    constructor(props: any) {\r\n        super(props);\r\n        // 初始状态\r\n        this.state = {\r\n            fixedFilter: false\r\n        };\r\n    }\r\n\r\n    render(): React.ReactElement<any, string | React.JSXElementConstructor<any>> | string | number | {} | React.ReactNodeArray | React.ReactPortal | boolean | null | undefined {\r\n        const {\r\n            props: {sortRules, goodsTypes, storeInfo, goodsList},\r\n            state: {fixedFilter},\r\n            onTabChange,\r\n            getList,\r\n            handleScroll\r\n        } = this\r\n        return (\r\n            <ScrollVertical className={'store_home_page'} onScroll={handleScroll} onLoadData={getList}\r\n                           >\r\n                <div className={'top_wrapper'}>\r\n                    <StoreTop className={'custom'} store={storeInfo} />\r\n                    <div className={'filter_wrapper'}>\r\n                        <div className={`filters ${fixedFilter ? 'fixed' : ''}`}>\r\n                            <VsonTabs initValue={0} options={goodsTypes} name={'shopType'}\r\n                                      onChange={onTabChange} />\r\n                            <VsonTabs initValue={0} options={sortRules} name={'sort'} onChange={onTabChange} />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <GoodsList list={goodsList} />\r\n                <BackHome />\r\n            </ScrollVertical>\r\n        );\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        this.getInitData()\r\n    }\r\n\r\n    onTabChange = async () => {\r\n        const {changeMallData, changeCommonData} = this.props\r\n        await changeCommonData({page: 1, totalPage: 0})\r\n        await changeMallData({goodsList: []})\r\n        this.getList()\r\n    }\r\n\r\n    getList = async () => {\r\n        const {getStoreHome, formFields, page, match: {params: {storeId}}} = this.props\r\n        const {sort = 0, shopType = 1} = formFields\r\n        return await getStoreHome({storeId, sort, shopType, page})\r\n    }\r\n\r\n    getInitData = async () => {\r\n        const {props: {wxOAuth2}, getList} = this\r\n        await wxOAuth2()\r\n        const {storeInfo: {storeName, storePresen, storeImg}} = await getList()\r\n        await WxConfig.onShare({\r\n            title: storeName,\r\n            desc: storePresen || storeName,\r\n            imgUrl: storeImg.medium\r\n        })\r\n    }\r\n\r\n    handleScroll = (e: any) => {\r\n        const {scrollTop} = e\r\n        const {fixedFilter} = this.state\r\n        if (fixedFilter && scrollTop > 120) return\r\n        this.setState({fixedFilter: scrollTop > 120})\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps: Readonly<any>, nextState: Readonly<any>, nextContext: any): boolean {\r\n        return true\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state: entries) {\r\n    const {goodsList} = state.mallReducer\r\n    const {storeInfo, goodsTypes, sortRules, formFields, page} = state.commonReducer\r\n    return {\r\n        goodsList,\r\n        storeInfo,\r\n        goodsTypes: [...goodsTypes].slice(0, 3),\r\n        sortRules,\r\n        formFields,\r\n        page\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: any) {\r\n    const {getStoreHome, changeMallData} = mallActions\r\n    const {wxOAuth2, changeCommonData} = commonActions\r\n    return {\r\n        ...bindActionCreators({\r\n            getStoreHome,\r\n            changeMallData,\r\n            changeCommonData,\r\n            wxOAuth2\r\n        }, dispatch),\r\n        dispatch\r\n    };\r\n}\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(StoreHome)\r\n"],"sourceRoot":""}