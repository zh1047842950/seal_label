{"version":3,"sources":["pages/museums/collection_list/index.tsx"],"names":["types","boutique","url","title","subtype","search","favorite","museum","CollectionList","props","onDelete","event","a","stopPropagation","deleteCollection","collectionList","changeCommonData","ids","map","e","checked","push","objectId","join","isOk","page","totalPage","getList","choseAll","bool","toggle","key","val","state","setState","navHome","match","params","by","id","museumId","history","pathname","toMuseumNavs","value","storeid","getInit","getMuseumSubTypeDetail","getMuseumDetail","typeId","data","fromWebview","Object","assign","name","N","WxConfig","setWxTitle","changeMuseumData","content","formFields","getCollections","p","edit","this","className","isMyself","museumHomeNavs","direction","align","initValue","activeColor","options","onChange","fieldType","placeholder","defaultValue","Item","onClick","src","alt","onLoadData","type","list","to","nextProps","nextState","nextContext","React","Component","connect","commonReducer","museumReducer","text","dispatch","museumActions","commonActions","bindActionCreators"],"mappings":"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","file":"static/js/18.dfd99f4b.chunk.js","sourcesContent":["import React from 'react'\r\nimport {entries} from \"reducer\";\r\nimport {museumActions, commonActions} from \"action\";\r\nimport {bindActionCreators} from \"redux\";\r\nimport {connect} from \"react-redux\";\r\nimport {Flex, Toast} from 'antd-mobile'\r\nimport {SearchNav, VsonField, VsonTabs, ScrollVertical, CollectionList as CollectionListComponent} from 'components'\r\n\r\nimport './index.scss'\r\nimport {Link} from \"react-router-dom\";\r\nimport {WxConfig} from \"../../../utils\";\r\n\r\ninterface P {\r\n    className?: string,\r\n    match: any,\r\n    history: any,\r\n    getCollections: any,\r\n    getMuseumDetail: any,\r\n    changeCommonData: any,\r\n    getMuseumSubTypeDetail: any,\r\n    changeMuseumData: any,\r\n    collectionList: any[],\r\n    museumHomeNavs: any[],\r\n    deleteCollection: any,\r\n    museum: any,\r\n    formFields: any,\r\n    page: number,\r\n    fromWebview: boolean\r\n}\r\n\r\ninterface S {\r\n    edit: boolean\r\n}\r\n\r\nconst types: any = {\r\n    boutique: {\r\n        url: '/queryBoutiqueObject',\r\n        title: ''\r\n    },\r\n    subtype: {\r\n        url: '/queryMuseumObjectList',\r\n        title: ''\r\n    },\r\n    search: {\r\n        url: '/seekMuseumObjectList',\r\n        title: ''\r\n    },\r\n    favorite: {\r\n        url: '/queryFavoriteMuseumObject',\r\n        title: '我的收藏'\r\n    },\r\n    museum: {\r\n        url: '/queryMuseumObjectList',\r\n        title: ''\r\n    }\r\n}\r\n\r\nclass CollectionList extends React.Component<P, S> {\r\n    // 构造\r\n    constructor(props: any) {\r\n        super(props);\r\n        // 初始状态\r\n        this.state = {edit: false};\r\n    }\r\n\r\n    render(): React.ReactElement<any, string | React.JSXElementConstructor<any>> | string | number | {} | React.ReactNodeArray | React.ReactPortal | boolean | null | undefined {\r\n        const {\r\n            props: {\r\n                fromWebview,\r\n                className = '',\r\n                collectionList,\r\n                match: {params: {by, id, isMyself, typeId, museumId}},\r\n                museumHomeNavs\r\n            },\r\n            state: {\r\n                edit\r\n            },\r\n            getInit,\r\n            toMuseumNavs,\r\n            navHome,\r\n            toggle,\r\n            choseAll,\r\n            onDelete,\r\n            getList\r\n        } = this\r\n        return (\r\n            <Flex direction={\"column\"} align={\"start\"} className={`collection_list_page`}>\r\n                {by === 'museum' && !fromWebview &&\r\n                <VsonTabs initValue={0} activeColor={'#6499AE'} options={museumHomeNavs} onChange={toMuseumNavs} />}\r\n                {by === 'search' &&\r\n                <VsonField onChange={getInit} fieldType={'search'} name={'content'} placeholder='请输入藏品名称'\r\n                           defaultValue={''} />}\r\n                {\r\n                    fromWebview && <div className='mall_title'>商城</div>\r\n                }\r\n                <Flex.Item className={`list`}>\r\n                    {by !== 'search' && !fromWebview && <Flex>\r\n                      <Flex.Item>\r\n                        <SearchNav className={`search_collection`} placeholder='请输入藏品名称'\r\n                                   page={'/museums/collection_list/search/' + id + '/' + isMyself} />\r\n                      </Flex.Item>\r\n                        {\r\n                            by !== 'favorite' && <img\r\n                              onClick={navHome} className={'museum_home'} src=\"/lsc_h5_hash/imgs/home0.png\" alt=\"\" />\r\n                        }\r\n                    </Flex>\r\n                    }\r\n                    <ScrollVertical onLoadData={getList}>\r\n                        <CollectionListComponent edit={edit} type={by} list={collectionList} />\r\n                    </ScrollVertical>\r\n                </Flex.Item>\r\n                {\r\n                    isMyself === 'true' && <Flex className={`oprs`}>\r\n                        {\r\n                            edit && <Flex.Item>\r\n                              <span onClick={() => choseAll(true)}>全选</span>\r\n                              <span onClick={() => choseAll(false)}>全不选</span>\r\n                              <span onClick={() => toggle('edit')}>取消</span>\r\n                              <span onClick={onDelete}>删除</span>\r\n                            </Flex.Item>\r\n                        }\r\n                      <img onClick={() => toggle('edit')} src=\"/lsc_h5_hash/imgs/edit.png\" alt=\"\" />\r\n                      <Link to={'/museums/collection_edit/' + id + '/' + typeId + '/' + museumId}>\r\n                        <img src=\"/lsc_h5_hash/imgs/add1.png\" alt=\"\" />\r\n                      </Link>\r\n                    </Flex>\r\n                }\r\n            </Flex>\r\n        );\r\n    }\r\n\r\n    onDelete = async (event: any) => {\r\n        event.stopPropagation()\r\n        const {deleteCollection, collectionList, changeCommonData} = this.props\r\n        let ids: string[] = []\r\n        collectionList.map((e: any) => {\r\n            if (e.checked) {\r\n                ids.push(e.objectId)\r\n            }\r\n        })\r\n        const {isOk} = await deleteCollection(ids.join('&'))\r\n        if (isOk) {\r\n            await changeCommonData({page: 1, totalPage: 0})\r\n            await this.getList()\r\n        }\r\n    }\r\n\r\n    choseAll = async (bool: boolean) => {\r\n\r\n    }\r\n\r\n    toggle = async (key: string) => {\r\n        // @ts-ignore\r\n        const val: boolean = this.state[key]\r\n        // @ts-ignore\r\n        this.setState({[key]: !val})\r\n    }\r\n\r\n    navHome = () => {\r\n        const {match: {params: {by, id, museumId}}, history} = this.props\r\n        history.push({pathname: '/museums/museum_home/' + (by === 'subtype' ? museumId : id)})\r\n    }\r\n\r\n    toMuseumNavs = async ({value, page}: any) => {\r\n        const {museum: {id, storeid}, history} = this.props\r\n        if (value === -1) return\r\n        history.push({pathname: page + '/' + (value === 5 ? storeid : id)})\r\n    }\r\n\r\n    getInit = async () => {\r\n        const {props: {changeCommonData, getMuseumSubTypeDetail, page, getMuseumDetail, match: {params: {by, id, typeId}}}, getList} = this\r\n        const data = {fromWebview: typeId === 'fromWebview'}\r\n        if (page !== 1) {\r\n            Object.assign(data, {page: 1, totalPage: 0})\r\n        }\r\n        await changeCommonData(data)\r\n        let name = '我的收藏'\r\n        if (by !== 'favorite') {\r\n            const {name: N} = by === 'subtype' ? await getMuseumSubTypeDetail(id) : await getMuseumDetail(id)\r\n            name = N //+(!!types[by].title?(' - ' + types[by].title):'')\r\n        }\r\n        await WxConfig.setWxTitle(name)\r\n        await getList()\r\n    }\r\n\r\n    getList = async () => {\r\n        const {changeMuseumData, match: {params: {by, id}}, formFields: {content}, page, getCollections} = this.props\r\n        const p = {page, content}\r\n        Object.assign(p, by === 'museum' ? {museumId: id} : {id})\r\n        if (by === 'search' && !content) {\r\n            await changeMuseumData({collectionList: []})\r\n            return\r\n        }\r\n        await getCollections({\r\n            url: types[by].url,\r\n            data: p\r\n        })\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        this.getInit()\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps: Readonly<any>, nextState: Readonly<any>, nextContext: any): boolean {\r\n        return true\r\n    }\r\n\r\n    componentWillReceiveProps(nextProps: Readonly<P>, nextContext: any): void {\r\n        const {match: {params: {by}}} = nextProps\r\n        const {match: {params: {by: oBy}}} = this.props\r\n        if (by !== oBy) {\r\n            this.getInit()\r\n        }\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state: entries) {\r\n    const {formFields, page, museumHomeNavs, fromWebview} = state.commonReducer\r\n    const {collectionList, museum} = state.museumReducer\r\n    return {\r\n        collectionList, fromWebview, formFields, page, museumHomeNavs: [\r\n            {\r\n                text: \"全部\",\r\n                value: -1\r\n            },\r\n            ...museumHomeNavs\r\n        ], museum\r\n    }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: any) {\r\n    const {getCollections, getMuseumDetail, changeMuseumData, getMuseumSubTypeDetail, deleteCollection} = museumActions\r\n    const {changeCommonData} = commonActions\r\n    return {\r\n        ...bindActionCreators({\r\n            getCollections,\r\n            changeCommonData,\r\n            getMuseumDetail,\r\n            changeMuseumData,\r\n            getMuseumSubTypeDetail,\r\n            deleteCollection\r\n        }, dispatch),\r\n        dispatch\r\n    };\r\n}\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(CollectionList)\r\n"],"sourceRoot":""}