{"version":3,"sources":["pages/museums/collection_detail/index.tsx"],"names":["CollectionDetail","props","onComment","a","commentCollection","formFields","getCollectionComments","changeCommonData","toggleModal","id","collection","content","isOk","page","onSetBoutique","setBoutique","getCollectionDetail","isBoutique","status","parseInt","onPraise","praiseCollection","onAttention","attentionMuseum","museumId","isAttention","onFavorite","favoriteCollection","isFavorite","getInit","match","params","fromWebview","myMuseums","index","findIndex","e","setState","isMySelf","name","document","title","gotoBuy","ua","navigator","userAgent","taobaoUrl","test","window","Android","h5GotoMall","webkit","messageHandlers","postMessage","console","log","goBack","history","state","this","className","collectionComments","direction","onClick","src","alt","Item","fixHeight","options","objectPriImg","museumLogo","medium","museumName","isPraise","praiseNum","describe","theme","list","justify","to","popup","animationType","fieldType","hasBottom","data","nextProps","nextState","nextContext","React","Component","connect","museumReducer","commonReducer","dispatch","commonActions","museumActions","bindActionCreators"],"mappings":"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","file":"static/js/16.4441aa96.chunk.js","sourcesContent":["import React from 'react'\r\nimport {bindActionCreators} from 'redux'\r\nimport {connect} from 'react-redux'\r\nimport {entries} from 'reducer'\r\nimport {commonActions, museumActions} from 'action'\r\nimport {Flex, Button} from 'antd-mobile'\r\nimport {Link} from 'react-router-dom'\r\nimport {\r\n    BackHome,\r\n    VsonField,\r\n    VsonBanner,\r\n    VsonModal,\r\n    CollectionDetail as CollectionDetailBody,\r\n    ScrollVertical,\r\n    CollectionComments,\r\n    CommentsNav\r\n} from 'components'\r\nimport './index.scss'\r\n\r\ninterface P {\r\n    className?: string,\r\n    history: any,\r\n    match: any,\r\n    collection: any,\r\n    collectionComments: any,\r\n    myMuseums: any[],\r\n    getCollectionDetail: any,\r\n    getCollectionComments: any,\r\n    praiseCollection: any,\r\n    attentionMuseum: any,\r\n    favoriteCollection: any,\r\n    setBoutique: any,\r\n    toggleModal: any,\r\n    commentCollection: any,\r\n    formFields: any,\r\n    changeCommonData: any\r\n}\r\n\r\ninterface S {\r\n    isMySelf: boolean,\r\n    fromWebview: boolean\r\n}\r\n\r\nclass CollectionDetail extends React.Component<P, S> {\r\n    // 构造\r\n    constructor(props: any) {\r\n        super(props);\r\n        // 初始状态\r\n        this.state = {\r\n            isMySelf: false,\r\n            fromWebview: false\r\n        };\r\n    }\r\n\r\n    render(): React.ReactElement<any, string | React.JSXElementConstructor<any>> | string | number | {} | React.ReactNodeArray | React.ReactPortal | boolean | null | undefined {\r\n        const {\r\n            props: {\r\n                className = '',\r\n                collection,\r\n                collectionComments,\r\n                toggleModal\r\n            },\r\n            state: {isMySelf, fromWebview},\r\n            onAttention,\r\n            onFavorite,\r\n            onPraise,\r\n            onSetBoutique,\r\n            onComment,\r\n            gotoBuy,\r\n            goBack\r\n        } = this\r\n        return (\r\n            <Flex className={`collection_detail_page`} direction={\"column\"}>\r\n                {\r\n                    fromWebview && <div className={'mall_title'}>\r\n                      <img\r\n                        onClick={goBack} src=\"/lsc_h5_hash/imgs/goback4.png\" alt=\"\" />\r\n                      <span>{collection.name}</span>\r\n                    </div>\r\n                }\r\n                <Flex.Item>\r\n                    <ScrollVertical>\r\n                        <VsonBanner fixHeight={true} options={collection.objectPriImg} />\r\n                        <div className={'item base_infos'}>\r\n                            <div className={'name'}>{collection.name}</div>\r\n                            <div className={'museum_name'}>\r\n                                {/*<Link to={'/museums/museum_home/' + collection.museumId}>*/}\r\n                                {!!collection.museumLogo && <img src={collection.museumLogo.medium} alt=\"\" />}\r\n                                {collection.museumName}\r\n                                {/*</Link>*/}\r\n                            </div>\r\n                            {\r\n                                !fromWebview && <Flex className={'actions'}>\r\n                                  <div onClick={onPraise} className={collection.isPraise === '0' ? 'active' : ''}>\r\n                                    <img\r\n                                      src={'/lsc_h5_hash/imgs/like_' + (collection.isPraise === '0' ? 2 : 3) + '.png'}\r\n                                      alt=\"\" />\r\n                                    <span>{collection.praiseNum}</span>\r\n                                  </div>\r\n                                  <div onClick={onAttention}>{collection.isAttention === '0' ? '已' : ''}关注</div>\r\n                                  <div onClick={onFavorite}>{collection.isFavorite === '0' ? '已' : ''}收藏</div>\r\n                                  <div>客服</div>\r\n                                </Flex>\r\n                            }\r\n                            <div className={'describe'}>{collection.describe}</div>\r\n                        </div>\r\n                        <CollectionDetailBody collection={collection} />\r\n                        {\r\n                            !fromWebview && <div className={'item comments'}>\r\n                              <CommentsNav theme={'museum'} params={[collection.id]} />\r\n                              <CollectionComments list={collectionComments} />\r\n                            </div>\r\n                        }\r\n                    </ScrollVertical>\r\n                </Flex.Item>\r\n                <Flex className={`oprs ${fromWebview ? '' : 'state7'}`} justify={fromWebview ? 'center' : \"end\"}>\r\n                    {\r\n                        isMySelf && <Link className={'opr'} to={'/museums/collection_edit/' + collection.id + '/edit'}>\r\n                          <img src=\"/lsc_h5_hash/imgs/edit3.png\" alt=\"\" />\r\n                          <span>编辑</span>\r\n                        </Link>\r\n                    }\r\n                    {\r\n                        isMySelf && <div className={'opr'} onClick={onSetBoutique}>\r\n                          <img src=\"/lsc_h5_hash/imgs/boutique.png\" alt=\"\" />\r\n                          <span>{collection.isBoutique === '1' ? '设为' : '取消'}精品</span>\r\n                        </div>\r\n                    }\r\n                    {\r\n                        fromWebview ? <Flex.Item onClick={gotoBuy} className={'goto_buy'}>去购买</Flex.Item> :\r\n                            <div className={'opr'} onClick={toggleModal}>\r\n                                <img src=\"/lsc_h5_hash/imgs/comment1.png\" alt=\"\" />\r\n                                <span>点评</span>\r\n                            </div>\r\n                    }\r\n                </Flex>\r\n                <VsonModal className={'collection_comment'}\r\n                           props={{popup: true, animationType: 'slide-up', title: '藏品评论'}}>\r\n                    <VsonField name={'content'} fieldType={'textarea'} />\r\n                    <Flex justify={\"end\"}>\r\n                        <span onClick={onComment} className={'state2'}>评论</span>\r\n                    </Flex>\r\n                </VsonModal>\r\n                {\r\n                    !fromWebview && <BackHome hasBottom={true} data={{museumId: collection.museumId}} />\r\n                }\r\n            </Flex>\r\n        );\r\n    }\r\n\r\n    componentDidMount(): void {\r\n        this.getInit()\r\n    }\r\n\r\n    onComment = async () => {\r\n        const {commentCollection, formFields, getCollectionComments, changeCommonData, toggleModal, collection: {id}} = this.props\r\n        const {isOk} = await commentCollection({id, content: formFields.content})\r\n        if (isOk) {\r\n            await toggleModal()\r\n            formFields.content = ''\r\n            await changeCommonData({formFields: {...formFields}})\r\n            await getCollectionComments({id, page: 1})\r\n        }\r\n    }\r\n\r\n    onSetBoutique = async () => {\r\n        const {setBoutique, getCollectionDetail, collection: {id, isBoutique}} = this.props\r\n        const {isOk} = await setBoutique({\r\n            id,\r\n            status: parseInt(isBoutique)\r\n        })\r\n        if (isOk) {\r\n            await getCollectionDetail(id)\r\n        }\r\n    }\r\n\r\n    onPraise = async () => {\r\n        const {praiseCollection, getCollectionDetail, collection: {id}} = this.props\r\n        const {isOk} = await praiseCollection(id)\r\n        if (isOk) {\r\n            await getCollectionDetail(id)\r\n        }\r\n    }\r\n\r\n    onAttention = async () => {\r\n        const {attentionMuseum, getCollectionDetail, collection: {museumId, isAttention, id}} = this.props\r\n        const {isOk} = await attentionMuseum({\r\n            id: museumId,\r\n            isAttention: isAttention === '0' ? 1 : 0\r\n        })\r\n        if (isOk) {\r\n            await getCollectionDetail(id)\r\n        }\r\n    }\r\n    onFavorite = async () => {\r\n        const {favoriteCollection, getCollectionDetail, collection: {id, isFavorite}} = this.props\r\n        const {isOk} = await favoriteCollection({\r\n            id,\r\n            status: parseInt(isFavorite)\r\n        })\r\n        if (isOk) {\r\n            await getCollectionDetail(id)\r\n        }\r\n    }\r\n\r\n    getInit = async () => {\r\n        const {match: {params: {id, fromWebview}}, formFields, changeCommonData, getCollectionDetail, getCollectionComments, myMuseums} = this.props\r\n        const index = myMuseums.findIndex((e: any) => e.museumId === museumId)\r\n        this.setState({isMySelf: index !== -1, fromWebview: fromWebview === 'true'})\r\n        const {name, museumId} = await getCollectionDetail(id)\r\n        document.title = name\r\n        await getCollectionComments({id, page: 1})\r\n        formFields.content = ''\r\n        await changeCommonData({formFields: {...formFields}})\r\n    }\r\n\r\n    gotoBuy = async () => {\r\n        const ua = navigator.userAgent\r\n        const {props: {collection: {id, taobaoUrl}}} = this\r\n        // 店铺分享页面  https://m.tb.cn/h.Vu2FPWz?sm=7532df\r\n        // window.location.href = `https://t.asczwa.com/taobao?backurl=${taobaoUrl}`\r\n        try {\r\n            if (/android/i.test(ua)) {\r\n                // @ts-ignore\r\n                window.Android.h5GotoMall(id, taobaoUrl)\r\n            }\r\n            if (/(iPhone|iPad|iPod|iOS)/i.test(ua)) {\r\n                // @ts-ignore\r\n                window.webkit.messageHandlers.h5GotoMall.postMessage(id, taobaoUrl)\r\n            }\r\n        } catch (e) {\r\n            console.log(e)\r\n        }\r\n    }\r\n\r\n    goBack = () => {\r\n        const {history} = this.props\r\n        history.goBack()\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps: Readonly<any>, nextState: Readonly<any>, nextContext: any): boolean {\r\n        return true\r\n    }\r\n}\r\n\r\n\r\nfunction mapStateToProps(state: entries) {\r\n    const {collection, collectionComments} = state.museumReducer\r\n    const {myMuseums, formFields} = state.commonReducer\r\n    return {collection, myMuseums, formFields, collectionComments}\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch: any) {\r\n    const {toggleModal, changeCommonData} = commonActions\r\n    const {getCollectionDetail, getCollectionComments, commentCollection, praiseCollection, attentionMuseum, favoriteCollection, setBoutique} = museumActions\r\n    return {\r\n        ...bindActionCreators({\r\n            getCollectionDetail,\r\n            getCollectionComments,\r\n            praiseCollection,\r\n            attentionMuseum,\r\n            favoriteCollection,\r\n            setBoutique,\r\n            toggleModal,\r\n            commentCollection,\r\n            changeCommonData\r\n        }, dispatch),\r\n        dispatch\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CollectionDetail)\r\n"],"sourceRoot":""}